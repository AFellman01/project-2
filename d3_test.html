<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="./test/d3.js" charset="utf-8"></script>
  </head>
  <body>
    <h1>Testing D3</h1>
    <input id="searchText" type="text" name="searchQ" value="">
    <button id="searchQuery"type="button" name="search">Search</button>
    <table>
      <tr>
        <th>Name</th>
        <th>State</th>
        <th>Chamber</th>
      </tr>
    </table>
    <style media="screen">
      .name:hover {
        color: blue;
        text-decoration: underline;
      }
    </style>
    <script type="text/javascript">

      $('#d3-btn').on('click', function() {
        d3Test();
      });

      var cleanData = [];
      var rejectData = [];
      var pctData = [];


      function d3Test() {
      // clean the data

        // ... for the house
        for (var i = 0; i < houseData.length; i++) {
          var obj = {
            id: houseData[i].id,
            name: "Rep. " + houseData[i].first_name + " " + houseData[i].last_name,
            chamber: "house",
            party: houseData[i].party,
            partyVote: houseData[i].votes_with_party_pct,
            missVote: houseData[i].missed_votes_pct
          };
          if (houseData[i].votes_with_party_pct !== undefined || houseData[i].missed_votes_pct === undefined) {
            cleanData.push(obj);
          } else {
            rejectData.push(obj);
          };
        };
        // ... for the senate
        for (var i = 0; i < senateData.length; i++) {
          var obj = {
            id: senateData[i].id,
            name: "Sen. " + senateData[i].first_name + " " + senateData[i].last_name,
            chamber: "senate",
            party: senateData[i].party,
            partyVote: senateData[i].votes_with_party_pct,
            missVote: senateData[i].missed_votes_pct
          };
          if (senateData[i].votes_with_party_pct !== undefined || senateData[i].missed_votes_pct === undefined) {
            cleanData.push(obj);
          } else {
            rejectData.push(obj);
          };
        };

        for (var i = 0; i < cleanData.length; i++) {
          pctData.push(cleanData[i].partyVote);
        };

        // pctData = JSON.stringify(pctData);
        // console.log(pctData);

        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        // set the ranges
        var x = d3.scaleLinear()
                  .domain([60, 100])
                  .rangeRound([0, width]);
        var y = d3.scaleLinear()
                  .range([height, 0]);

        // set the parameters for the histogram
        var histogram = d3.histogram()
                  .value(function(d) { return d.partyVote; })
                  .domain(x.domain())
                  .thresholds(300);

        // append the svg object to the body of the page
        // append a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("body").append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          // Define the div for the tooltip
          var div = d3.select("body").append("div")
              .attr("class", "tooltip")
              .style("opacity", 0);

        // group the data for the bars
        var bins = histogram(cleanData);
        console.log(bins);

        // svg.call(tip);
        // Scale the range of the data in the y domain
        y.domain([0, d3.max(bins, function(d) { return d.length; })]);

        // append the bar rectangles to the svg element
        svg.selectAll("rect")
            .data(bins)
          .enter().append("rect")
            .attr("class", "bar")
            .attr("x", 1)
            .attr("transform", function(d) {
            return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function(d) { return x(d.x1) - x(d.x0) - 0.5 ; })
            .attr("height", function(d) { return height - y(d.length); })
            .on("mouseover", function(d) {
              div.transition()
                .duration(200)
                .style("opacity", .9);
                div.html(d.name + ", "  + d.party)
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
              })
            .on("mouseout", function(d) {
              div.transition()
                .duration(500)
                .style("opacity", 0);
        });

        // add the x Axis
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // add the y Axis
        svg.append("g")
            .call(d3.axisLeft(y));
      }; // End of function



    </script>
  </body>
</html>
